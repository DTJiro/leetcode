##### æ€è·¯

é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ„é€ Resultä¹‹ä¸­çš„å‰ä¸¤åˆ—ï¼ˆcte1ï¼‰ï¼Œå¯ä»¥ç”¨unionç›´æ¥æŠŠbothåµŒè¿›å»ï¼Œç„¶åå†é€šè¿‡ã€æ¯äººæ¯å¤©ç”¨çš„ä¸åŒå¹³å°æ•°=2ã€‘çš„æ¡ä»¶å»å®šä¹‰ã€bothã€‘ï¼ˆcte2ï¼‰ï¼Œç„¶åå†left joinè®¡ç®—total_amount å’Œ total_users

##### ç®—æ³•

1. è¦æ„é€ Resultä¹‹ä¸­çš„å‰ä¸¤åˆ—

* sql

```sql
with cte1 as
(
    select distinct spend_date, 'desktop'  as platform from spending
    union 
    select distinct spend_date, 'mobile' from spending
    union
    select distinct spend_date, 'both' from spending
)

# è¾“å‡º
{"headers": ["spend_date", "platform"], 
"values": [["2019-07-01", "desktop"], 
           ["2019-07-02", "desktop"], 
           ["2019-07-01", "mobile"], 
           ["2019-07-02", "mobile"], 
           ["2019-07-01", "both"], 
           ["2019-07-02", "both"]]}
```

2. å®šä¹‰ã€bothã€‘

* sql

```sql
cte2 as
(
select
    user_id,
    spend_date,
    if(count(distinct platform)=2,'both',platform) as platform,
    sum(amount) as amount
from spending
group by 1,2
)

# è¾“å‡º
{"headers": ["user_id", "spend_date", "platform", "amount"], 
"values": [[1, "2019-07-01", "both", 200], 
           [2, "2019-07-01", "mobile", 100], 
           [2, "2019-07-02", "mobile", 100], 
           [3, "2019-07-01", "desktop", 100], 
           [3, "2019-07-02", "desktop", 100]]}
```

3. left joinè®¡ç®—

* sql

```sql
select 
    t1.spend_date,
    t1.platform,
    ifnull(sum(t2.amount),0) as total_amount,
    ifnull(count(t2.user_id),0) as total_users
from cte1 t1
left join cte2 t2
using(spend_date,platform)
group by 1,2
```

##### ç­”æ¡ˆ

* sql

```sql
# Write your MySQL query statement below

with cte1 as
(
    select distinct spend_date, 'desktop'  as platform from spending
    union 
    select distinct spend_date, 'mobile' from spending
    union
    select distinct spend_date, 'both' from spending
),

cte2 as
(
select
    user_id,
    spend_date,
    if(count(distinct platform)=2,'both',platform) as platform,
    sum(amount) as amount
from spending
group by 1,2
)


select 
    t1.spend_date,
    t1.platform,
    ifnull(sum(t2.amount),0) as total_amount,
    ifnull(count(t2.user_id),0) as total_users
from cte1 t1
left join cte2 t2
using(spend_date,platform)
group by 1,2
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°
