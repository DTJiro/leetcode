# ç®—æ³•å…¬å¼€è¯¾

**ã€Šä»£ç éšæƒ³å½•ã€‹ç®—æ³•è§†é¢‘å…¬å¼€è¯¾ï¼š[æ™®å¤§å–œå¥”ï¼äºŒå‰æ ‘ç« èŠ‚å·²å…¨éƒ¨æ›´å®Œå•¦ï¼| LeetCodeï¼š538.æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘](https://www.bilibili.com/video/BV1d44y1f7wP?share_source=copy_web)ï¼Œç›¸ä¿¡ç»“åˆè§†é¢‘åœ¨çœ‹æœ¬ç¯‡é¢˜è§£ï¼Œæ›´æœ‰åŠ©äºå¤§å®¶å¯¹æœ¬é¢˜çš„ç†è§£**ã€‚

# æ€è·¯

ä¸€çœ‹åˆ°ç´¯åŠ æ ‘ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½ä¼šç–‘æƒ‘ï¼šå¦‚ä½•ç´¯åŠ ï¼Ÿé‡åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†éå†å…¶ä»–èŠ‚ç‚¹ç´¯åŠ ï¼Ÿæ€ä¹ˆä¸€æƒ³è¿™ä¹ˆéº»çƒ¦å‘¢ã€‚

ç„¶åå†å‘ç°è¿™æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼ŒäºŒå‰æœç´¢æ ‘å•Šï¼Œè¿™æ˜¯æœ‰åºçš„å•Šã€‚

é‚£ä¹ˆæœ‰åºçš„å…ƒç´ å¦‚ä½•æ±‚ç´¯åŠ å‘¢ï¼Ÿ

**å…¶å®è¿™å°±æ˜¯ä¸€æ£µæ ‘ï¼Œå¤§å®¶å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹åˆ«æ‰­ï¼Œæ¢ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„[2, 5, 13]ï¼Œæ±‚ä»ååˆ°å‰çš„ç´¯åŠ æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯[20, 18, 13]ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™å°±ç®€å•äº†ã€‚**

ä¸ºä»€ä¹ˆå˜æˆæ•°ç»„å°±æ˜¯æ„Ÿè§‰ç®€å•äº†å‘¢ï¼Ÿ

å› ä¸ºæ•°ç»„å¤§å®¶éƒ½çŸ¥é“æ€ä¹ˆéå†å•Šï¼Œä»åå‘å‰ï¼ŒæŒ¨ä¸ªç´¯åŠ å°±å®Œäº‹äº†ï¼Œè¿™æ¢æˆäº†äºŒå‰æœç´¢æ ‘ï¼Œçœ‹èµ·æ¥å°±åˆ«æ‰­äº†ä¸€äº›æ˜¯ä¸æ˜¯ã€‚

é‚£ä¹ˆçŸ¥é“å¦‚ä½•éå†è¿™ä¸ªäºŒå‰æ ‘ï¼Œä¹Ÿå°±è¿åˆƒè€Œè§£äº†ï¼Œ**ä»æ ‘ä¸­å¯ä»¥çœ‹å‡ºç´¯åŠ çš„é¡ºåºæ˜¯å³ä¸­å·¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åä¸­åºéå†è¿™ä¸ªäºŒå‰æ ‘ï¼Œç„¶åé¡ºåºç´¯åŠ å°±å¯ä»¥äº†**ã€‚

## é€’å½’

éå†é¡ºåºå¦‚å›¾æ‰€ç¤ºï¼š

![image.png](https://pic.leetcode.cn/1671596689-DKHjFJ-image.png)

æœ¬é¢˜ä¾ç„¶éœ€è¦ä¸€ä¸ªpreæŒ‡é’ˆè®°å½•å½“å‰éå†èŠ‚ç‚¹curçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·æ‰æ–¹ä¾¿åšç´¯åŠ ã€‚

preæŒ‡é’ˆçš„ä½¿ç”¨æŠ€å·§ï¼Œæˆ‘ä»¬åœ¨[äºŒå‰æ ‘ï¼šæœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®](https://programmercarl.com/0530.äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®.html)å’Œ[äºŒå‰æ ‘ï¼šæˆ‘çš„ä¼—æ•°æ˜¯å¤šå°‘ï¼Ÿ](https://programmercarl.com/0501.äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°.html)éƒ½æåˆ°äº†ï¼Œè¿™æ˜¯å¸¸ç”¨çš„æ“ä½œæ‰‹æ®µã€‚

* é€’å½’å‡½æ•°å‚æ•°ä»¥åŠè¿”å›å€¼

è¿™é‡Œå¾ˆæ˜ç¡®äº†ï¼Œä¸éœ€è¦é€’å½’å‡½æ•°çš„è¿”å›å€¼åšä»€ä¹ˆæ“ä½œäº†ï¼Œè¦éå†æ•´æ£µæ ‘ã€‚

åŒæ—¶éœ€è¦å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡preï¼Œç”¨æ¥ä¿å­˜curèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°å€¼ï¼Œå®šä¹‰ä¸ºintå‹å°±å¯ä»¥äº†ã€‚

ä»£ç å¦‚ä¸‹ï¼š

* 

```
int pre = 0; // è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°å€¼
void traversal(TreeNode* cur)
```

* ç¡®å®šç»ˆæ­¢æ¡ä»¶

é‡ç©ºå°±ç»ˆæ­¢ã€‚

* 

```
if (cur == NULL) return;
```

* ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘

æ³¨æ„**è¦å³ä¸­å·¦æ¥éå†äºŒå‰æ ‘**ï¼Œ ä¸­èŠ‚ç‚¹çš„å¤„ç†é€»è¾‘å°±æ˜¯è®©curçš„æ•°å€¼åŠ ä¸Šå‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°å€¼ã€‚

ä»£ç å¦‚ä¸‹ï¼š

* 

```
traversal(cur->right);  // å³
cur->val += pre;        // ä¸­
pre = cur->val;
traversal(cur->left);   // å·¦
```

é€’å½’æ³•æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š

* CPP

```CPP
class Solution {
private:
    int pre = 0; // è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°å€¼
    void traversal(TreeNode* cur) { // å³ä¸­å·¦éå†
        if (cur == NULL) return;
        traversal(cur->right);
        cur->val += pre;
        pre = cur->val;
        traversal(cur->left);
    }
public:
    TreeNode* convertBST(TreeNode* root) {
        pre = 0;
        traversal(root);
        return root;
    }
};
```

## è¿­ä»£æ³•

è¿­ä»£æ³•å…¶å®å°±æ˜¯ä¸­åºæ¨¡æ¿é¢˜äº†ï¼Œåœ¨[äºŒå‰æ ‘ï¼šå‰ä¸­ååºè¿­ä»£æ³•](https://programmercarl.com/äºŒå‰æ ‘çš„è¿­ä»£éå†.html)å’Œ[äºŒå‰æ ‘ï¼šå‰ä¸­ååºç»Ÿä¸€æ–¹å¼è¿­ä»£æ³•](https://programmercarl.com/äºŒå‰æ ‘çš„ç»Ÿä¸€è¿­ä»£æ³•.html)å¯ä»¥é€‰ä¸€ç§è‡ªå·±ä¹ æƒ¯çš„å†™æ³•ã€‚

è¿™é‡Œæˆ‘ç»™å‡ºå…¶ä¸­çš„ä¸€ç§ï¼Œä»£ç å¦‚ä¸‹ï¼š

* CPP

```CPP
class Solution {
private:
    int pre; // è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°å€¼
    void traversal(TreeNode* root) {
        stack<TreeNode*> st;
        TreeNode* cur = root;
        while (cur != NULL || !st.empty()) {
            if (cur != NULL) {
                st.push(cur);
                cur = cur->right;   // å³
            } else {
                cur = st.top();     // ä¸­
                st.pop();
                cur->val += pre;
                pre = cur->val;
                cur = cur->left;    // å·¦
            }
        }
    }
public:
    TreeNode* convertBST(TreeNode* root) {
        pre = 0;
        traversal(root);
        return root;
    }
};
```

# æ€»ç»“

ç»å†äº†å‰é¢å„ç§äºŒå‰æ ‘å¢åˆ æ”¹æŸ¥çš„æ´—ç¤¼ä¹‹åï¼Œè¿™é“é¢˜ç›®åº”è¯¥æ¯”è¾ƒç®€å•äº†ã€‚

**å¥½äº†ï¼ŒäºŒå‰æ ‘å·²ç»æ¥è¿‘å°¾å£°äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦å¯¹äºŒå‰æ ‘æ¥ä¸€ä¸ªå¤§æ€»ç»“äº†**ã€‚

# å…¶ä»–è¯­è¨€ç‰ˆæœ¬

* []

```Java
class Solution {
    int sum;
    public TreeNode convertBST(TreeNode root) {
        sum = 0;
        convertBST1(root);
        return root;
    }

    // æŒ‰å³ä¸­å·¦é¡ºåºéå†ï¼Œç´¯åŠ å³å¯
    public void convertBST1(TreeNode root) {
        if (root == null) {
            return;
        }
        convertBST1(root.right);
        sum += root.val;
        root.val = sum;
        convertBST1(root.left);
    }
}
```

* []

```python
**é€’å½’**
# Definition for a binary tree node.
# class TreeNode:
#     def __init__(self, val=0, left=None, right=None):
#         self.val = val
#         self.left = left
#         self.right = right
class Solution:
    def __init__(self):
        self.pre = TreeNode()

    def convertBST(self, root: Optional[TreeNode]) -> Optional[TreeNode]:
        '''
        å€’åºç´¯åŠ æ›¿æ¢ï¼š  
        [2, 5, 13] -> [[2]+[1]+[0], [2]+[1], [2]] -> [20, 18, 13]
        '''
        self.traversal(root)
        return root

    def traversal(self, root: TreeNode) -> None:
        # å› ä¸ºè¦éå†æ•´æ£µæ ‘ï¼Œæ‰€ä»¥é€’å½’å‡½æ•°ä¸éœ€è¦è¿”å›å€¼
        # Base Case
        if not root: 
            return None
        # å•å±‚é€’å½’é€»è¾‘ï¼šä¸­åºéå†çš„åè¯‘ - å³ä¸­å·¦
        self.traversal(root.right)  # å³

        # ä¸­èŠ‚ç‚¹ï¼šç”¨å½“å‰rootçš„å€¼åŠ ä¸Špreçš„å€¼
        root.val += self.pre.val    # ä¸­
        self.pre = root             

        self.traversal(root.left)   # å·¦
```

* []

```go
// å¼„ä¸€ä¸ªsumæš‚å­˜å…¶å’Œå€¼
var pre int
func convertBST(root *TreeNode) *TreeNode {
    pre = 0
    traversal(root)
    return root
}

func traversal(cur *TreeNode) {
    if cur == nil {
        return
    }
    traversal(cur.Right)
    cur.Val += pre
    pre = cur.Val
    traversal(cur.Left)
}
```

* []

```javascript
// é€’å½’
var convertBST = function(root) {
    let pre = 0;
    const ReverseInOrder = (cur) => {
        if(cur) {
            ReverseInOrder(cur.right);
            cur.val += pre;
            pre = cur.val;
            ReverseInOrder(cur.left);
        }
    }
    ReverseInOrder(root);
    return root;
};

// è¿­ä»£
var convertBST = function (root) {
    let pre = 0;
    let cur = root;
    let stack = [];
    while (cur !== null || stack.length !== 0) {
        while (cur !== null) {
            stack.push(cur);
            cur = cur.right;
        }
        cur = stack.pop();
        cur.val += pre;
        pre = cur.val;
        cur = cur.left;
    }
    return root;
};
```

* []

```c
// é€’å½’
int pre;
void traversal(struct TreeNode* node) {
    if(!node)
        return ;
    traversal(node->right);
    node->val = node->val + pre;
    pre = node->val;
    traversal(node->left);
}

struct TreeNode* convertBST(struct TreeNode* root){
    pre = 0;
    traversal(root);
    return root;
}
```

* []

```typescript
// é€’å½’æ³•
function convertBST(root: TreeNode | null): TreeNode | null {
    let pre: number = 0;
    function recur(root: TreeNode | null): void {
        if (root === null) return;
        recur(root.right);
        root.val += pre;
        pre = root.val;
        recur(root.left);
    }
    recur(root);
    return root;
};

// > è¿­ä»£æ³•
function convertBST(root: TreeNode | null): TreeNode | null {
    const helperStack: TreeNode[] = [];
    let curNode: TreeNode | null = root;
    let pre: number = 0;
    while (curNode !== null || helperStack.length > 0) {
        while (curNode !== null) {
            helperStack.push(curNode);
            curNode = curNode.right;
        }
        curNode = helperStack.pop()!;
        curNode.val += pre;
        pre = curNode.val;
        curNode = curNode.left;
    }
    return root;
};
```

* []

```scala
object Solution {
  def convertBST(root: TreeNode): TreeNode = {
    var sum = 0
    def convert(node: TreeNode): Unit = {
      if (node == null) return
      convert(node.right)
      sum += node.value
      node.value = sum
      convert(node.left)
    }
    convert(root)
    root
  }
}
```

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜Carlï¼Œå¦‚æœä½ è¿˜åœ¨æ²¡æœ‰ç« æ³•çš„åˆ·é¢˜ï¼Œ**å»ºè®®æŒ‰ç…§[ä»£ç éšæƒ³å½•åˆ·é¢˜è·¯çº¿](https://programmercarl.com/)æ¥åˆ·**ï¼Œå¹¶æä¾›[PDFä¸‹è½½](https://programmercarl.com/other/algo_pdf.html)ï¼Œåˆ·é¢˜è·¯çº¿åŒæ—¶ä¹Ÿå¼€æºåœ¨[Github](https://github.com/youngyangyang04/leetcode-master)ä¸Šï¼Œä½ ä¼šå‘ç°è¯¦è§å¾ˆæ™šï¼

**å¦‚æœæ„Ÿè§‰é¢˜è§£å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸è¦åå•¬ç»™ä¸€ä¸ªğŸ‘å§ï¼**

