##### æ€è·¯

é¦–å…ˆæ˜ç¡®ä¸­ä½æ•°çš„ç®—æ³•ï¼šç»™å®šä¸€ä¸ªæ•°åˆ—ï¼ˆé•¿åº¦ä¸ºnï¼‰ã€‚

1. ä»å°åˆ°å¤§æ’åº
2. å¦‚æœnä¸ºå¶æ•°ï¼Œåˆ™ç¬¬`n/2`å’Œ`n/2+1`ä¸ªå€¼ä¸ºä¸­ä½æ•°
3. å¦‚æœnä¸ºå¥‡æ•°ï¼Œåˆ™ç¬¬`(n+1)/2`ä¸ªå€¼ä¸ºä¸­ä½æ•°

é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ’åºï¼ˆè¿™é‡Œè¦ç”¨row_numberï¼‰å› ä¸ºæˆ‘ä»¬æ’åºæ˜¯ä¸ºäº†æ‰¾ç´¢å¼•ï¼ˆä¸èƒ½é‡å¤ï¼‰

ä¹‹ååˆ©ç”¨æ’åºå’Œnçš„å…³ç³»æ±‚è§£ã€‚

##### ç®—æ³•

1. æ’åº&è®¡ç®—n

* sql

```sql
select 
	a.*,
    row_number() over(partition by Company order by Salary) as rnk, # æ’åºæ‰¾ç´¢å¼•
    count(Salary) over(partition by Company) as cnt 				# è®¡ç®—nï¼ˆæ¯ä¸ªcompanyçš„salaryæœ‰å¤šå°‘ä¸ªï¼‰
from Employee a
order by rnk

# è¾“å‡º
{"headers": ["id", "company", "salary", "rnk", "cnt"], 
"values": [[3, "A", 15, 1, 6], 
           [2, "A", 341, 2, 6], 
           [5, "A", 451, 3, 6], 
           [6, "A", 513, 4, 6], 
           [1, "A", 2341, 5, 6], 
           [4, "A", 15314, 6, 6], 
           [8, "B", 13, 1, 6], 
           [7, "B", 15, 2, 6], 
           [12, "B", 234, 3, 6], 
           [9, "B", 1154, 4, 6], 
           [11, "B", 1221, 5, 6], 
           [10, "B", 1345, 6, 6], 
           [17, "C", 65, 1, 5], 
           [13, "C", 2345, 2, 5], 
           [14, "C", 2645, 3, 5], 
           [15, "C", 2645, 4, 5], 
           [16, "C", 2652, 5, 5]]}
```

2. æ‰¾æ’åºå’Œnçš„å…³ç³»

å¯ä»¥å‘ç°ï¼Œå½“`rnk in (cnt/2, cnt/2+1, (cnt+1)/2)`çš„æƒ…å†µä¸‹æˆç«‹ã€‚

å› ä¸ºè¿™æ ·å¯ä»¥å·§å¦™åœ°**é¿å…è®¨è®ºnçš„å¥‡å¶æ€§**ã€‚

- å› ä¸ºå½“nä¸ºå¶æ•°æ—¶ï¼Œ`(cnt+1)/2`å¿…ä¸ºåˆ†æ•°ï¼Œæ‰€ä»¥æ­¤æ—¶`rnk <> (cnt+1)/2`ã€‚
- åä¹‹äº¦ç„¶

---

æˆ‘ä»¬è¿˜å¯ä»¥ç”¨**æ­£ååº**æ¥å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç›®çš„ä¹Ÿæ˜¯é¿å…è®¨è®ºå¥‡å¶æ€§ã€‚

1. å–æ­£ååº

* sql

```sql
select
    a.*,
    row_number() over(partition by company order by salary, id) as rnk1,
    row_number() over(partition by company order by salary desc, id desc) as rnk2,
    count(id) over(partition by company) as cnt
from Employee a

# è¾“å‡º
# æ­¤æ—¶ rnk1 + rnk2 = cnt
{"headers": ["id", "company", "salary", "rnk1", "rnk2", "cnt"], 
"values": [[1, "A", 2341, 5, 2, 6], 
           [6, "A", 513, 4, 3, 6], 
           [5, "A", 451, 3, 4, 6], 
           [2, "A", 341, 2, 5, 6], 
           [3, "A", 15, 1, 6, 6], 
           [4, "A", 15314, 6, 1, 6], 
           [9, "B", 1154, 4, 3, 6], 
           [8, "B", 13, 1, 6, 6], 
           [7, "B", 15, 2, 5, 6], 
           [12, "B", 234, 3, 4, 6], 
           [11, "B", 1221, 5, 2, 6], 
           [10, "B", 1345, 6, 1, 6], 
           [16, "C", 2652, 5, 1, 5], 
           [15, "C", 2645, 4, 2, 5], 
           [14, "C", 2645, 3, 3, 5], 
           [13, "C", 2345, 2, 4, 5], 
           [17, "C", 65, 1, 5, 5]]}
```

2. æ‰¾æ­£ååºå’Œnçš„å…³ç³»

å¿…é¡»æ»¡è¶³`rnk1>=cnt/2 and rnk2>=cnt/2`ã€‚

- å½“nä¸ºå¶æ•°ï¼Œä¸Šè¿°æ¡ä»¶ä¼šè¿”å›ä¸¤ä¸ªå€¼
- å½“nä¸ºå¥‡æ•°ï¼Œä¸Šè¿°æ¡ä»¶åªè¿”å›ä¸€ä¸ªå€¼

##### ç­”æ¡ˆ

1. è®¨è®ºæ’åºå’Œnçš„å…³ç³»

* sql

```sql
select 
	Id,Company,Salary 
from 
(
    select 
    	a.*,
    	row_number() over(partition by Company order by Salary) as rnk,
    	count(Salary) over(partition by Company) as cnt 
   	from Employee a
) t 
where rnk in (cnt/2,cnt/2+1,(cnt+1)/2)
```

2. æ­£ååº

* sql

```sql
select
    id,company,salary
from
(select
    a.*,
    row_number() over(partition by company order by salary, id) as rnk1,
    row_number() over(partition by company order by salary desc, id desc) as rnk2,
    count(id) over(partition by company) as cnt
from Employee a) tmp
where rnk1 >= cnt/2 
and rnk2 >= cnt/2
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°
